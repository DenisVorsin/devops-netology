
# ДЗ 4.1. Командная оболочка Bash" Ворсин Денис

## Обязательная задача 1

Есть скрипт:
```bash
a=1
b=2
c=a+b
d=$a+$b
e=$(($a+$b))
```

Какие значения переменным c,d,e будут присвоены? Почему?

| Переменная | Значение | Обоснование                                                             |
|------------|----------|-------------------------------------------------------------------------|
| `c`        | a+b      | для bash "a+b" - просто строка                                          |
| `d`        | 1+2      | $ означает что a и b - переменные, + - просто символ.                   |
| `e`        | 3        | $(()) - внутри такой конструкции баш производит арифметические операции |


## Обязательная задача 2
На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет его доступность, записывая дату проверок до тех пор, пока сервис не станет доступным (после чего скрипт должен завершиться). В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на Жёстком Диске постоянно уменьшается. Что необходимо сделать, чтобы его исправить:
```bash
while ((1==1)
do
	curl https://localhost:4757
	if (($? != 0))
	then
	    date >> curl.log
	fi
done
```


        в скрипте допущены несколько ошибок: 
            - не хватает второй закрывающей скобки в строке в while
            - не прописано условие для завершения работы скрипта, например: if [[ $? == 0 ]]; then exit; fi 
            - место завершается потому что date дописывает в лог файл. чтобы в логе была только последняя дата можно сделать date > curl.log

Необходимо написать скрипт, который проверяет доступность трёх IP: `192.168.0.1`, `173.194.222.113`, `87.250.250.242` по `80` порту и записывает результат в файл `log`. Проверять доступность необходимо пять раз для каждого узла.

### Ваш скрипт:
```bash
#!/usr/bin/env bash

#список адресов для проверки
Addrs=("192.168.0.1" "173.194.222.113" "87.250.250.242")
#количество попыток для проверки
n=5
#Расположение Лог-файла
LogFile="./some.log"

i=0
while (( $i < ${#Addrs[@]} ))
do
echo "$(date +%Y%m%d_%H:%M) Test ${Addrs[$i]}" >> $LogFile
j=0
  while (( $j < $n ))
  do
    curl -s http://${Addrs[$i]}:80 > /dev/null
    rez=$?
    echo "$(date +%Y%m%d_%H:%M) try$(($j+1)): $( if [[ $rez == 0 ]]; then echo success; else echo failed; fi )" >> $LogFile
    let j+=1
  done
let i+=1
done
```

## Обязательная задача 3
Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не окажется недоступным. Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается.

### Ваш скрипт:
```bash
#!/usr/bin/env bash

#список адресов для проверки
Addrs=("10.0.2.15" "173.194.222.113" "87.250.250.242")
#количество попыток для проверки
n=5
#Расположение Лог-файла
LogFile="./some.log"


while ((1==1))
do
i=0
while (( $i < ${#Addrs[@]} ))
do
echo "$(date +%Y%m%d_%H:%M) Test ${Addrs[$i]}" >> $LogFile
j=0
  while (( $j < $n ))
  do
    curl -s http://${Addrs[$i]}:80 > /dev/null
    rez=$?
    echo "$(date +%Y%m%d_%H:%M) try$(($j+1)): $( if [[ $rez == 0 ]]; then echo success; else echo failed; fi )" >> $LogFile
    if [[ $rez != 0 ]]; then echo "$(date +%Y%m%d_%H:%M) Connection with ${Addrs[$i]} failed " >> $LogFile; exit; fi
    let j+=1
  done
let i+=1
done

sleep 1
done
```

лог файл работы скрипта: [ссылка на логфайл](DZ_4.1/some.log)